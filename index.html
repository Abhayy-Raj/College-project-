<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Smart Library Portal (fixed & cleaned)</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0;font-family:"Poppins",sans-serif}
    body{background:linear-gradient(135deg,#f0f4ff,#c2e9fb);color:#333;min-height:100vh}
    header{position:fixed;top:0;left:0;right:0;display:flex;justify-content:space-between;align-items:center;padding:14px 28px;background:rgba(255,255,255,0.9);backdrop-filter:blur(8px);z-index:999;box-shadow:0 6px 20px rgba(2,48,53,0.06)}
    .logo{font-weight:700;color:#0077b6}
    nav{display:flex;gap:14px}
    nav a{color:#0077b6;text-decoration:none;font-weight:600;padding:6px 8px;border-radius:8px}
    nav a.active,nav a:hover{background:rgba(6,35,32,0.04);color:#023e8a}
    main{max-width:1100px;margin:110px auto 40px;padding:0 18px}
    .hero{min-height:300px;background:url('https://images.unsplash.com/photo-1512820790803-83ca734da794') center/cover no-repeat;border-radius:14px;color:#fff;display:flex;align-items:center;justify-content:space-between;padding:28px;position:relative;overflow:hidden}
    .hero::after{content:"";position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,0.45),rgba(0,0,0,0.25))}
    .hero-inner{position:relative;z-index:2;max-width:64%}
    .hero h1{color:#ffdd00;font-size:1.9rem;margin-bottom:8px}
    .hero p{color:#eaf6f5;margin-bottom:14px}
    .btn{display:inline-block;padding:10px 16px;border-radius:999px;border:0;font-weight:700;cursor:pointer}
    .btn-primary{background:linear-gradient(90deg,#06bfb6,#05908e);color:#fff}
    .btn-accent{background:linear-gradient(90deg,#ff8a3d,#ff6a1a);color:#fff}
    .glass-card{background:rgba(255,255,255,0.85);padding:20px;border-radius:12px;box-shadow:0 8px 30px rgba(2,48,53,0.06)}
    .section{background:#fff;padding:18px;border-radius:12px;margin-top:20px;box-shadow:0 8px 30px rgba(2,48,53,0.04)}
    .manage-header{display:flex;justify-content:space-between;align-items:center;gap:12px}
    input[type=text],input[type=password],input[type=email],select,textarea{padding:10px;border-radius:8px;border:1px solid #e6f0ef;width:100%}
    .book-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px;margin-top:12px}
    .book-card{padding:12px;border-radius:12px;background:linear-gradient(180deg,#fbfffe,#ffffff);box-shadow:0 6px 18px rgba(2,48,53,0.03)}
    .student-list{margin-top:12px}
    .student-item{display:flex;justify-content:space-between;align-items:center;padding:8px;border-bottom:1px solid #eef6f5}
    footer{text-align:center;padding:18px;margin-top:24px;background:#023e8a;color:#fff;border-radius:8px}
    @media(max-width:800px){.hero{flex-direction:column;gap:12px}.hero-inner{max-width:100%}}
  </style>
</head>
<body>
  <header>
    <div class="logo">ðŸ“š Smart Library</div>
    <nav>
      <a href="#" id="navHome" class="active">Home</a>
      <a href="#" id="navLogin">Login</a>
      <a href="#" id="navRegister">Register</a>
      <a href="#" id="navBooks">Books</a>
    </nav>
  </header>

  <main>
    <!-- HERO -->
    <div class="hero">
      <div class="hero-inner">
        <h1>Welcome to Smart Library</h1>
        <p>Discover, borrow, and read â€” with separate admin & student experiences.</p>
        <div style="display:flex;gap:8px;margin-top:12px;position:relative;z-index:2">
          <button id="ctaStart" class="btn btn-primary">Get Started</button>
          <button id="ctaBrowse" class="btn btn-accent">Browse Books</button>
        </div>
      </div>
      <div style="width:320px;position:relative;z-index:2">
        <div class="glass-card">
          <div style="font-weight:700;margin-bottom:8px">Current time</div>
          <div id="clock">--:--:--</div>
        </div>
      </div>
    </div>

    <!-- LOGIN SECTION (hidden by default) -->
    <div id="loginSection" class="section" style="display:none">
      <h3>Login Portal</h3>
      <div style="display:flex;gap:12px;margin-top:12px;flex-wrap:wrap">
        <div style="flex:1;min-width:240px">
          <label><strong>Role</strong></label>
          <select id="userTypeSelect">
            <option value="student">Student</option>
            <option value="admin">Admin</option>
          </select>
          <label style="margin-top:8px"><strong>Username</strong></label>
          <input id="inputUsername" type="text" placeholder="username">
          <label style="margin-top:8px"><strong>Password</strong></label>
          <input id="inputPassword" type="password" placeholder="password">
          <div style="display:flex;gap:8px;margin-top:12px">
            <button id="btnLogin" class="btn btn-primary">Login</button>
            <button id="btnBackHome" class="btn" style="background:#f6fdfc;border:1px solid #e6f0ef">Back</button>
          </div>
        </div>
        <div style="flex:1;min-width:240px">
          <div style="background:#f6fffd;padding:12px;border-radius:8px">
            <strong>Notes</strong>
            <p style="margin-top:8px;color:#556">Admin credentials: <code>admin</code> / <code>admin123</code></p>
            <p style="margin-top:6px;color:#556">Register as a new student from the Register page.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- REGISTER SECTION -->
    <div id="registerSection" class="section" style="display:none">
      <h3>Student Registration</h3>
      <div style="max-width:720px;margin-top:12px">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
          <div>
            <label>Full name</label>
            <input id="regName" type="text" placeholder="Jane Student">
          </div>
          <div>
            <label>Email</label>
            <input id="regEmail" type="email" placeholder="jane@example.com">
          </div>
          <div>
            <label>Username</label>
            <input id="regUsername" type="text" placeholder="janest">
          </div>
          <div>
            <label>Password</label>
            <input id="regPassword" type="password" placeholder="choose a password">
          </div>
        </div>
        <div style="margin-top:12px;display:flex;gap:8px">
          <button id="btnRegister" class="btn btn-primary">Register</button>
          <button id="btnRegisterBack" class="btn" style="background:#f6fdfc;border:1px solid #e6f0ef">Back</button>
        </div>
      </div>
    </div>

    <!-- BOOKS SECTION -->
    <div id="booksSection" class="section" style="display:none">
      <div id="adminControls" style="display:none" class="manage-header">
        <div style="display:flex;gap:8px;align-items:center">
          <input id="searchAdmin" type="text" placeholder="Search books (admin)">
        </div>
        <div style="display:flex;gap:8px">
          <button id="btnAddBook" class="btn btn-primary">+ Add Book</button>
          <button id="btnViewStudents" class="btn">ðŸ‘¥ View Students</button>
        </div>
      </div>

      <div id="studentControls" style="display:none" class="manage-header">
        <div style="display:flex;gap:8px;align-items:center">
          <input id="searchStudent" type="text" placeholder="Search books (student)">
        </div>
        <div></div>
      </div>

      <div id="booksGrid" class="book-grid"></div>

      <!-- Students list (admin only) -->
      <div id="studentsPanel" class="student-list" style="display:none;margin-top:16px">
        <h4>Registered Students</h4>
        <div id="studentsContainer"></div>
      </div>
    </div>

    <!-- TRIAL -->
    <div class="section" style="margin-top:18px">
      <h4>Apply for a library trial</h4>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px">
        <input id="trialName" type="text" placeholder="Your name" style="flex:1;min-width:180px">
        <input id="trialEmail" type="email" placeholder="Your email" style="flex:1;min-width:180px">
        <button id="btnApplyTrial" class="btn btn-accent">Apply</button>
      </div>
    </div>
  </main>

  <footer>Â© 2025 Smart Library Portal</footer>

  <script>
    /********************
     DOM references (explicit)
    ********************/
    const navHome = document.getElementById('navHome');
    const navLogin = document.getElementById('navLogin');
    const navRegister = document.getElementById('navRegister');
    const navBooks = document.getElementById('navBooks');
    const ctaStart = document.getElementById('ctaStart');
    const ctaBrowse = document.getElementById('ctaBrowse');

    const loginSection = document.getElementById('loginSection');
    const registerSection = document.getElementById('registerSection');
    const booksSection = document.getElementById('booksSection');
    const homeSection = document.querySelector('.hero');

    const userTypeSelect = document.getElementById('userTypeSelect');
    const inputUsername = document.getElementById('inputUsername');
    const inputPassword = document.getElementById('inputPassword');
    const btnLogin = document.getElementById('btnLogin');
    const btnBackHome = document.getElementById('btnBackHome');

    const regName = document.getElementById('regName');
    const regEmail = document.getElementById('regEmail');
    const regUsername = document.getElementById('regUsername');
    const regPassword = document.getElementById('regPassword');
    const btnRegister = document.getElementById('btnRegister');
    const btnRegisterBack = document.getElementById('btnRegisterBack');

    const adminControls = document.getElementById('adminControls');
    const studentControls = document.getElementById('studentControls');
    const btnAddBook = document.getElementById('btnAddBook');
    const btnViewStudents = document.getElementById('btnViewStudents');

    const booksGrid = document.getElementById('booksGrid');
    const searchAdmin = document.getElementById('searchAdmin');
    const searchStudent = document.getElementById('searchStudent');

    const studentsPanel = document.getElementById('studentsPanel');
    const studentsContainer = document.getElementById('studentsContainer');

    const btnApplyTrial = document.getElementById('btnApplyTrial');
    const trialName = document.getElementById('trialName');
    const trialEmail = document.getElementById('trialEmail');

    // Nav helpers
    function hideAllSections(){
      loginSection.style.display='none';
      registerSection.style.display='none';
      booksSection.style.display='none';
      homeSection.style.display='block';
      document.querySelectorAll('nav a').forEach(a=>a.classList.remove('active'));
    }
    function showHome(){ hideAllSections(); homeSection.style.display='block'; navHome.classList.add('active'); }
    function showLogin(){ hideAllSections(); homeSection.style.display='none'; loginSection.style.display='block'; navLogin.classList.add('active'); }
    function showRegister(){ hideAllSections(); homeSection.style.display='none'; registerSection.style.display='block'; navRegister.classList.add('active'); }
    function showBooks(){ hideAllSections(); homeSection.style.display='none'; booksSection.style.display='block'; navBooks.classList.add('active'); }

    navHome.addEventListener('click',(e)=>{ e.preventDefault(); showHome(); });
    navLogin.addEventListener('click',(e)=>{ e.preventDefault(); showLogin(); });
    navRegister.addEventListener('click',(e)=>{ e.preventDefault(); showRegister(); });
    navBooks.addEventListener('click',(e)=>{ e.preventDefault(); showBooks(); renderBooks(); });

    ctaStart.addEventListener('click', (e)=>{ e.preventDefault(); showLogin(); });
    ctaBrowse.addEventListener('click', (e)=>{ e.preventDefault(); showBooks(); renderBooks(); });

    /********************
     App data
    ********************/
    const adminCreds = { username:'admin', password:'admin123' };
    // seed students & books (in-memory demo)
    let students = [
      { name:'John Doe', email:'john@example.com', username:'student', password:'student123' }
    ];
    let books = [
      { id:1, title:'The Great Gatsby', author:'F. Scott Fitzgerald' },
      { id:2, title:'To Kill a Mockingbird', author:'Harper Lee' },
      { id:3, title:'1984', author:'George Orwell' },
      { id:4, title:'Pride and Prejudice', author:'Jane Austen' }
    ];

    // current session info
    let session = { role:null, username:null };

    /********************
     Clock
    ********************/
    const clockEl = document.getElementById('clock');
    function updateClock(){ clockEl.textContent = new Date().toLocaleString(); }
    setInterval(updateClock,1000); updateClock();

    /********************
     Registration
    ********************/
    btnRegister.addEventListener('click', () => {
      const name = regName.value.trim();
      const email = regEmail.value.trim();
      const username = regUsername.value.trim();
      const password = regPassword.value.trim();
      if(!name || !email || !username || !password) { alert('Please fill all fields'); return; }
      if(students.some(s=>s.username.toLowerCase()===username.toLowerCase())){ alert('Username already exists'); return; }
      students.push({ name, email, username, password });
      alert('Registration successful â€” you can now login');
      regName.value=''; regEmail.value=''; regUsername.value=''; regPassword.value='';
      showLogin();
    });
    btnRegisterBack.addEventListener('click', ()=> showHome());

    /********************
     Login (fixed)
    ********************/
    btnLogin.addEventListener('click', () => {
      const role = userTypeSelect.value;
      const username = inputUsername.value.trim();
      const password = inputPassword.value.trim();
      if(!username || !password){ alert('Enter username and password'); return; }

      if(role === 'admin'){
        if(username === adminCreds.username && password === adminCreds.password){
          session = { role:'admin', username };
          inputUsername.value=''; inputPassword.value='';
          setupUIForRole();
          showBooks();
          renderBooks();
          return;
        } else {
          alert('Invalid admin credentials');
          return;
        }
      } else { // student
        const found = students.find(s => (s.username === username) && s.password === password);
        if(found){
          session = { role:'student', username: found.username, studentName: found.name };
          inputUsername.value=''; inputPassword.value='';
          setupUIForRole();
          showBooks();
          renderBooks();
          return;
        } else {
          alert('Invalid student credentials');
          return;
        }
      }
    });
    btnBackHome.addEventListener('click', ()=> showHome());

    /********************
     Setup UI based on role
    ********************/
    function setupUIForRole(){
      if(session.role === 'admin'){
        adminControls.style.display='flex';
        studentControls.style.display='none';
        studentsPanel.style.display='none';
      } else if(session.role === 'student'){
        adminControls.style.display='none';
        studentControls.style.display='flex';
        studentsPanel.style.display='none';
      } else {
        adminControls.style.display='none';
        studentControls.style.display='none';
        studentsPanel.style.display='none';
      }
    }

    /********************
     Books: render/add/delete/search (fixed single implementation)
    ********************/
    function renderBooks(list){
      const arr = list || books;
      booksGrid.innerHTML = '';
      if(!arr || arr.length === 0){ booksGrid.innerHTML = '<div style="color:#556">No books available</div>'; return; }
      arr.forEach(b => {
        const card = document.createElement('div');
        card.className = 'book-card';
        card.innerHTML = `
          <h4 style="margin:0 0 8px 0">${escapeHtml(b.title)}</h4>
          <div style="color:#556;margin-bottom:12px">by ${escapeHtml(b.author)}</div>
        `;
        const controls = document.createElement('div');
        controls.style.display='flex';
        controls.style.justifyContent='flex-end';
        controls.style.gap='8px';

        if(session.role === 'admin'){
          const del = document.createElement('button');
          del.className='btn';
          del.textContent='Delete';
          del.addEventListener('click', ()=> {
            if(!confirm('Delete this book?')) return;
            books = books.filter(x=>x.id!==b.id);
            renderBooks();
          });
          controls.appendChild(del);
        } else {
          const access = document.createElement('button');
          access.className='btn btn-accent';
          access.textContent='Access E-Book';
          access.addEventListener('click', ()=> alert(`Opening e-book: "${b.title}" (demo)`));
          controls.appendChild(access);
        }
        card.appendChild(controls);
        booksGrid.appendChild(card);
      });
    }

    btnAddBook.addEventListener('click', ()=>{
      if(session.role !== 'admin'){ alert('Only admin can add books'); return; }
      const title = prompt('Enter book title:');
      if(!title) return;
      const author = prompt('Enter author:');
      if(!author) return;
      const id = books.length ? Math.max(...books.map(b=>b.id))+1 : 1;
      books.push({ id, title, author });
      renderBooks();
      alert('Book added');
    });

    // search handlers
    function renderFilteredBooks(q){
      if(!q) return renderBooks(books);
      const filtered = books.filter(b => (`${b.title} ${b.author}`).toLowerCase().includes(q));
      renderBooks(filtered);
    }
    searchAdmin.addEventListener('input', ()=> {
      const q = searchAdmin.value.trim().toLowerCase();
      renderFilteredBooks(q);
    });
    searchStudent.addEventListener('input', ()=> {
      const q = searchStudent.value.trim().toLowerCase();
      renderFilteredBooks(q);
    });

    /********************
     Admin: students list & remove
    ********************/
    btnViewStudents.addEventListener('click', ()=>{
      if(session.role !== 'admin'){ alert('Only admin can view students'); return; }
      studentsPanel.style.display = studentsPanel.style.display === 'none' ? 'block' : 'none';
      renderStudentsList();
    });

    function renderStudentsList(){
      studentsContainer.innerHTML = '';
      if(!students.length){ studentsContainer.innerHTML = '<div style="color:#556">No students registered</div>'; return; }
      students.forEach((s, idx)=>{
        const row = document.createElement('div'); row.className='student-item';
        const left = document.createElement('div'); left.textContent = `${s.name} (${s.username}) â€” ${s.email}`;
        const right = document.createElement('div');
        const btnImp = document.createElement('button'); btnImp.className='btn'; btnImp.textContent='Login as';
        btnImp.addEventListener('click', ()=> {
          if(!confirm(`Impersonate ${s.username}?`)) return;
          session = { role:'student', username:s.username, studentName:s.name };
          setupUIForRole();
          renderBooks(books);
          alert('Now impersonating ' + s.name);
          showBooks();
        });
        const btnRemove = document.createElement('button'); btnRemove.className='btn'; btnRemove.textContent='Remove';
        btnRemove.addEventListener('click', ()=> {
          if(!confirm(`Remove ${s.username}?`)) return;
          students.splice(idx,1);
          renderStudentsList();
        });
        right.style.display='flex'; right.style.gap='8px'; right.appendChild(btnImp); right.appendChild(btnRemove);
        row.appendChild(left); row.appendChild(right);
        studentsContainer.appendChild(row);
      });
    }

    /********************
     Trial
    ********************/
    btnApplyTrial.addEventListener('click', ()=>{
      const n = trialName.value.trim(), e = trialEmail.value.trim();
      if(!n || !e){ alert('Enter name and email'); return; }
      alert(`Trial application received for ${n}. We'll email ${e} (demo).`);
      trialName.value=''; trialEmail.value='';
    });

    /********************
     Utility
    ********************/
    function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;' }[m])); }

    // start on home
    showHome();
    setupUIForRole();
    renderBooks(books);
  </script>
</body>
</html>
